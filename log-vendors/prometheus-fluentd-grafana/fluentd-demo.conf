## Prometheus Input Plugin Configuration

# input plugin that exports metrics
<source>
  @type prometheus
</source>

<source>
  @type monitor_agent
</source>

<source>
  @type forward
</source>

# input plugin that collects metrics from MonitorAgent
<source>
  @type prometheus_monitor
  <labels>
    host ${hostname}
  </labels>
</source>

# input plugin that collects metrics for output plugin
<source>
  @type prometheus_output_monitor
  <labels>
    host ${hostname}
  </labels>
</source>

# input plugin that collects metrics for in_tail plugin
<source>
  @type prometheus_tail_monitor
  <labels>
    host ${hostname}
  </labels>
</source>

# LOG LEVEL ERROR
<source>
  @type dummy
  @id log_level_error
  tag jfrog.rt.artifactory.service
  dummy '{"log_level":"ERROR"}'
</source>

# Data Transfers (GBs) Over Time.
<source>
  @type dummy
  @id data_transfer_over_time1
  tag jfrog.rt.artifactory.request
  rate 10
  dummy '{"request_url":"/api/docker/johnp-docker/test/centos","repo":"johnp-docker","artifact":"centos","dockerRepo":"johnp-docker","dockerImage":"centos","response_content_length":1235343,"request_content_length":34323,"return_status":200,"remote_address":"64.55.33.22","data_download": 1235343,"data_upload":34323}'
</source>
<source>
  @type dummy
  @id data_transfer_over_time2
  tag jfrog.rt.artifactory.request
  rate 2
  dummy '{"request_url":"/api/docker/docker-local/test/ubuntu","repo":"docker-local","artifact":"ubuntu","dockerRepo":"docker-local","dockerImage":"ubuntu","response_content_length":1235543,"request_content_length":123,"return_status":401,"remote_address":"33.44.11.22","data_download": 1235543,"data_upload":123}'
</source>
<source>
  @type dummy
  @id data_transfer_over_time3
  tag jfrog.rt.artifactory.request
  rate 5
  dummy '{"request_url":"/api/docker/docker-local2/test/oraclelinux","repo":"docker-local2","artifact":"oraclelinux","dockerRepo":"docker-local2","dockerImage":"oraclelinux","response_content_length":5535343,"request_content_length":33334323,"return_status":203,"remote_address":"10.0.3.15","data_download": 5535343,"data_upload":33334323}'
</source>
<source>
  @type dummy
  @id data_transfer_over_time4
  tag jfrog.rt.artifactory.request
  rate 8
  dummy '{"request_url":"/api/docker/docker-local3/test/redhat-ubi8","repo":"docker-local3","artifact":"redhat-ubi8","dockerRepo":"docker-local3","dockerImage":"redhat-ubi8","response_content_length":5235343,"request_content_length":3499323,"return_status":201,"remote_address":"107.1.3.34","data_download": 5235343,"data_upload":3499323}'
</source>
<source>
  @type dummy
  @id data_transfer_over_time5
  tag jfrog.rt.artifactory.request
  dummy '{"request_url":"/api/docker/docker-local4/test/debian","repo":"docker-local4","artifact":"debian","dockerRepo":"docker-local4","dockerImage":"debian","response_content_length":500,"request_content_length":1000,"return_status":201,"remote_address":"1.1.3.2","data_download": 500,"data_upload":1000}'
</source>
#send empty string
<source>
  @type dummy
  @id data_transfer_over_time6
  tag jfrog.rt.artifactory.request
  dummy '{"request_url":"/api/docker/docker-local4/test/debian","repo":"","artifact":"","dockerRepo":"","dockerImage":"","response_content_length":345,"request_content_length":576,"return_status":201,"remote_address":"1.1.3.6","data_download": 345,"data_upload":576}'
</source>

# Audit Actions
<source>
  @type dummy
  @id audit_actions1
  tag jfrog.rt.access.audit
  rate 1
  dummy '{"user":"johnp"}'
</source>
<source>
  @type dummy
  @id audit_actions2
  tag jfrog.rt.access.audit
  rate 2
  dummy '{"user":"vinaya"}'
</source>
<source>
  @type dummy
  @id audit_actions3
  tag jfrog.rt.access.audit
  rate 3
  dummy '{"user":"mahithab"}'
</source>
<source>
  @type dummy
  @id audit_actions4
  tag jfrog.rt.access.audit
  rate 4
  dummy '{"user":"jefff"}'
</source>

# 500 errors
<source>
  @type dummy
  @id five_hundrend_errors
  tag jfrog.rt.artifactory.request
  dummy '{"request_url":"/api/docker/error","repo":"","artifact":"","dockerRepo":"","dockerImage":"","response_content_length":0,"request_content_length":0,"return_status":500,"remote_address":"4.1.5.6","data_download": 0,"data_upload":0}'
</source>

# Xray Log Level Errors
<source>
  @type dummy
  @id xray_log_level_error
  tag jfrog.xray.server.service
  dummy '{"log_level":"ERROR"}'
</source>

# Xray 500 errors
<source>
  @type dummy
  @id xray_five_hundrend_errors
  tag jfrog.xray.xray.request
  dummy '{"return_status":"500"}'
</source>

# DENIED LOGINS
<source>
  @type dummy
  @id denied_logins1
  tag jfrog.rt.artifactory.access
  rate 5
  dummy '{"action_response":"DENIED Login","ip":"10.15.1.2","username":"johnp"}'
</source>
<source>
  @type dummy
  @id denied_logins2
  tag jfrog.rt.artifactory.access
  rate 6
  dummy '{"action_response":"DENIED LOGIN","ip":"51.10.13.22","username":"vinaya"}'
</source>
<source>
  @type dummy
  @id denied_logins3
  tag jfrog.rt.artifactory.access
  rate 4
  dummy '{"action_response":"DENIED LOGIN","ip":"64.5.12.23","username":"mahithab"}'
</source>
<source>
  @type dummy
  @id denied_logins4
  tag jfrog.rt.artifactory.access
  rate 3
  dummy '{"action_response":"DENIED","ip":"107.10.12.27","username":"idog"}'
</source>
<source>
  @type dummy
  @id denied_logins5
  tag jfrog.rt.artifactory.access
  rate 5
  dummy '{"action_response":"DENIED","ip":"11.11.14.24","username":"jefff"}'
</source>
<source>
  @type dummy
  @id denied_logins6
  tag jfrog.rt.artifactory.access
  rate 60
  dummy '{"action_response":"DENIED","ip":"10.0.1.2","username":"badguy"}'
</source>

# ACCEPTED DEPLOY
<source>
  @type dummy
  @id accepted_deploy1
  tag jfrog.rt.artifactory.access
  rate 1
  dummy '{"action_response":"ACCEPTED DEPLOY","ip":"64.5.12.23","username":"mahithab"}'
</source>
<source>
  @type dummy
  @id accepted_deploy2
  tag jfrog.rt.artifactory.access
  rate 2
  dummy '{"action_response":"ACCEPTED DEPLOY","ip":"107.10.12.27","username":"idog"}'
</source>
<source>
  @type dummy
  @id accepted_deploy3
  tag jfrog.rt.artifactory.access
  rate 3
  dummy '{"action_response":"ACCEPTED DEPLOY","ip":"11.11.14.24","username":"jefff"}'
</source>

# WHAT LOG IT WAS INTO THE JSON
<filter jfrog.**>
  @type record_transformer
  <record>
    hostname "#{Socket.gethostname}"
    log_source ${tag}
  </record>
</filter>

<filter jfrog.rt.artifactory.request>
  @type prometheus

  <metric>
    name jfrog_rt_data_download
    type gauge
    desc artifactory data download
    key data_download
    <labels>
      host ${hostname}
      remote_address ${remote_address}
      repo ${repo}
      response_content_length ${response_content_length}
      data_download ${data_download}
    </labels>
  </metric>

  <metric>
    name jfrog_rt_data_upload
    type gauge
    desc artifactory data upload
    key data_upload
    <labels>
      host ${hostname}
      remote_address ${remote_address}
      repo ${repo}
      request_content_length ${request_content_length}
      data_upload ${data_upload}
    </labels>
  </metric>

  <metric>
    name jfrog_rt_req
    type counter
    desc artifactory requests
    <labels>
      host ${hostname}
      request_url ${request_url}
      return_status ${return_status}
      repo ${repo}
      artifact ${artifact}
      dockerRepo ${dockerRepo}
      dockerImage ${dockerImage}
      remote_address ${remote_address}
    </labels>
  </metric>
</filter>

<filter jfrog.rt.artifactory.service>
@type prometheus
  <metric>
    name jfrog_rt_log_level
    type counter
    desc artifactory log_levels
    <labels>
      host ${hostname}
      log_level ${log_level}
    </labels>
  </metric>
</filter>

<filter jfrog.rt.artifactory.access>
@type prometheus

<metric>
  name jfrog_rt_access
  type counter
  desc artifactory access
  <labels>
    host ${hostname}
    username ${username}
    action_response ${action_response}
    ip ${ip}
  </labels>
</metric>

</filter>
